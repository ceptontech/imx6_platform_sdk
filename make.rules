#make.rules
C_FLAGS 	+= $(MODULE_C_FLAGS)
C_INCLUDES 	+= $(MODULE_C_INCLUDES)
C_DEFINES 	+= $(MODULE_C_DEFINES)

A_FLAGS 	+= $(MODULE_A_FLAGS)
A_INCLUDES 	+= $(MODULE_A_INCLUDES)
A_DEFINES 	+= $(MODULE_A_DEFINES)

all: $(MODULE_OUT) $(MODULE_OBJS)
ifneq "$(MODULE)" "init"
		$(AR) -rucs $(TARGET_LIB) $(MODULE_OBJS)
endif
	
	
$(MODULE_OUT): 
	@-$(MKDIR) $(MODULE_OUT)

$(MODULE_OUT)/%.o: %.c
        # Generate make dependencies and compile. The -MP option creates empty targets
        # for each header file so that a rebuild will be forced if the file goes missing, but
        # no error will occur.
		$(CC)  $(C_FLAGS) $(C_INCLUDES) $(C_DEFINES) -MD -MF $(MODULE_OUT)/$*.d -MP -o $@ -c $<

$(MODULE_OUT)/%.o: %.S
		$(CC)  $(C_FLAGS)  $(C_INCLUDES) $(C_DEFINES) -Wa,-MD,$(MODULE_OUT)/$*.d -o $@ -c $<

$(MODULE_OUT)/%.o: %.s
		$(AS)  $(A_FLAGS) $(C_INCLUDES) $(A_DEFINES) -MD $(MODULE_OUT)/$*.d -o $@ $<
